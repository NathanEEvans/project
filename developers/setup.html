<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>Stormcloud IDE</title>
        <link rel="stylesheet" href="../stylesheets/styles.css">
        <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="wrapper">
            <header>
                <a href="../index.html">
                    <img alt="Stormcloud IDE" src="../images/logo.png">  
                </a>
                <p>
                    Coding in the Cloud
                </p>
                <p class="view"><a href="https://github.com/stormcloud-ide">View Stormcloud IDE on GitHub <small>stormcloud-ide</small></a></p>
                <ul>
                    <li><a href="../community/index.html">IDE <strong>Community</strong></a></li>
                    <li><a href="../showcase/showcase.html">Show <strong>Case</strong></a></li>
                    <li><a href="../docs/docs.html">Manuals <strong>&amp; Docs</strong></a></li>
                </ul>

            </header>
            <section>

                <h3>Developer setup manual</h3>

                <h4>Introduction</h4>

                <p>
                    This is an attempt to guide you (a developer) over the bumps of setting up your environment 
                    so you can run the Stormcloud IDE and join in the development. 
                    As it is a work in progress i ask you to bear with me and point out errors and/or 
                    shortcomings so at some point it will be an accurate and complete document. 
                </p>

                <p>
                    First off start with forking the 
                    <a href="https://github.com/stormcloud-ide/project">Project</a>, 
                    <a href="https://github.com/stormcloud-ide/gui">GUI</a> and 
                    <a href="https://github.com/stormcloud-ide/api">API</a> repositories
                    and give them a star of course! ;)
                </p>

                <h4>At a glance</h4>

                <p>
                    Before we start there are a few conceptual things you need to understand. Just to know where what goes.
                </p>

                <p>
                    The Stormcloud IDE consists of three parts, these are GUI, API and User Home. In the image below the GUI 
                    domain has the blue-ish/purple overlay, the API is yellow and the User home is green.
                </p>

                <img src="../images/architecture-colored-domains.png">

                <p>
                    In theory the GUI, API and User home can all three be placed on different machines but when you develop 
                    for it they will all three live on one and the same machine, the one you will develop on. 
                </p>
                <p>
                    This does give some-things-todo with respect to tomcat port numbers that will bump into each other, keep that in mind,
                    it's included in the manual to change the port numbers of the User Home Tomcat instance if you run everything 
                    on one machine.
                </p>
                <p>
                    Of course you can choose to place it over multiple machines but that will complicate things for development 
                    and should only be done for deployments aimed at using the IDE, not develop for it. 
                </p>

                <h4>Short description</h4>

                <p>
                    The <strong>GUI</strong> is a pure html/javascript project and the idea behind it is to keep it a pure javascript
                    client which makes http requests to the Stormcloud Rest API on the server. The GUI components are all created with 
                    the Dojo toolkit, these are called widgets. The stormcloud part is 'bootstrapped' from the js/stormcloud/stormcloud.js
                    and it has been setup following the <a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a> mechanism.
                </p>

                <p>
                    The <strong>API</strong> project is a maven project serving the Rest API. The glue is Spring and there are a few 
                    modules glued together: core (containing model pojo's, entites, dao and things like that), Debug, Filesystem, Git,
                    Java, Maven, Tomcat and Web (the war file). Quite straight forward each module contains the specific parts to realize 
                    functionality basically matching the module name.
                </p>

                <p>
                    The <strong>User Home</strong> is a layout of folders on the filesystem containing all the 'private parts'
                    (ehm, well, you know what i mean ;)) like project, private JVM/Tomcat instance and some 'internals' folders.
                </p>

                <h4>Set it all up.</h4>

                <p>
                    Now. For the work that needs to be done. Take your time to do this, do not rush it as you will definitely end 
                    up chasing your tail (depending on your experience on the matter) making you pull your hair out and ending up in
                    the corner of the room with a tinfoil cap on your head thinking you are a banana. Not good (for most of us).
                </p>

                <p>
                    Let's get to it then.
                </p>

                <h4>Building the Super POM</h4>

                <p>
                    We will start with the Project repository. This repository contains the super pom, you will need to build this one 
                    first otherwise the API project will not build.
                </p>

                <p>
                    So Fork the <a href="https://github.com/stormcloud-ide/project">stormcloud/project</a> repository, clone the Fork 
                    to your local machine and run <code>mvn clean install</code> on it.
                    (i'm always including 'clean',. that's just me, you don't have to do that). This should set you up with the project super 
                    pom in your maven repository.
                </p>

                <h4>Setting up the GUI</h4>

                <p>
                    Fork the <a href="https://github.com/stormcloud-ide/gui">stormcloud/gui</a> repository and clone the Fork to your 
                    local machine.
                </p>
                <p>

                    The Stormcloud IDE GUI is served trough apache, so you need to have an apache installation and a site-enabled 
                    which serves the contents of the gui repository you just cloned. The project as cloned is ready to exactly be copy 
                    pasted into a website root. What i do is create a symlink from the dir where i cloned the repository 
                    to the dir apache knows has to serve. That way you can edit/view and commit directly without the hassle of moving 
                    things around, of course you can set it up anyway it works best for you.
                </p>

                <p>
                    Make sure you have mod_proxy_http loaded as well (this will probably change to the ajp connector for reasons not
                    discussed here as it's beyond the scope of this document).
                </p>

                <p>
                    When that is done the GUI should be correctly served from http://your-machine/<br>
                    I have placed it in the apache doc root, you can also use a different folder if you have other sites running 
                    locally (for example http://localhost/[your-site-folder]/), that's all up to you, how you like to work.
                </p>

                <p>
                    At this point you should be able to see the GUI as shown below when accessing <a href="http://localhost">http://localhost</a> 
                    or whatever folder you placed the site in.
                </p>

                <p>
                    <img src="../images/empty-ide.png">
                </p>

                <p>
                    This is <strong>without</strong> projects, files or services visible in the left side explorer panes as the GUI cannot reach the Rest API (yet). 
                    The GUI components should all work though (menus, tabs..), meaning Dojo is correctly loaded.
                </p>

                <h4>The API (Rest Service)</h4>

                <p>
                    Now for the next part. The Rest API is served from tomcat. (not the same one as the User Home is going to use!)
                </p>


                <h5>Tomcat</h5>

                <p>
                    Make sure you have a correctly installed and working Tomcat (i use tomcat 7) which you can reach trough 
                    <a href="http://localhost:8080">http://localhost:8080</a> where the Tomcat welcome page should show up.
                </p>

                <p>
                    <img src="../images/tomcat-welcome.png">
                </p>


                <p>
                    You will have to copy a suitable MySQL driver (grab one <a href="http://dev.mysql.com/downloads/connector/j/">here</a>) into the [tomcat-home]/lib folder.
                </p>

                <p>
                    We use c3p0 for connection pooling. Grab yourself a copy <a href="https://sourceforge.net/projects/c3p0/">here</a>. Also place this jar in
                    the tomcat lib folder and create a file called c3p0.properties, again in the [tomcat-home]/lib folder and add this in the file.
                </p>

                <pre>
c3p0.preferredTestQuery         = SELECT 1
c3p0.testConnectionOnCheckout   = true
c3p0.acquireRetryDelay          = 1
c3p0.acquireRetryAttempts       = 1
                </pre>

                <h5>MySQL</h5>

                <p>
                    As you might have noticed by now, the API uses a MySQL database, so make sure you have mysql installed. Verify your installation by being able to
                    login to the MySQL instance (either via command prompt or your favorite SQL tool).
                </p>

                <p>
                    Next you will have to create the stormcloud database by running the MySQL dump you will find in 
                    api/core/src/main/database/stormcloud.dump, run it on your MySQL instance to create the database 
                    and create a user which has write access to (or choose an existing one for that matter).
                </p>

                <h5>Properties file</h5>


                <p>
                    The API contains some spring configuration which is using a properties file to find the connection specifications 
                    for the MySQL database we just created in the previous section. You will find a properties file in <br>
                    api/core/src/main/properties/stormcloud.properties. 
                </p>

                <p>
                    Copy this file into the [tomcat-home]/lib/properties folder (create the properties dir). Make sure the url points
                    to the correct host & database. Also change the username and password to read the user on your MySQL instance that can 
                    access the stormcloud database.
                </p>

                <pre>
stormcloud.db.driver        = com.mysql.jdbc.Driver
stormcloud.db.url           = jdbc:mysql://localhost:3306/stormcloud
stormcloud.db.username      = stormcloud
stormcloud.db.password      = stormcloud
stormcloud.db.max.poolsize  = 5
stormcloud.db.min.poolsize  = 1
                </pre>



                <h3>User Home (Filesystem)</h3>

                <p>
                    We are now going to create the User Home. 
                </p>

                <p>
                    Create the following folder structure in a directory of your choice (i have it in /filesystem/martijn) but you 
                    can really place it anywhere. So create these folders in there:
                </p>

                <pre>
.log
.m2
.trash
java
projects
tomcat
                </pre>

                <p>
                    Also create the folder /var/log/stormcloud, this is where the API logging goes.
                </p>

                <p>
                    Make sure these folders are writable to the user which runs your Tomcat instance, place them in the same group or something like that. 
                    I just run tomcat as the same user as the folder owner, but that can be done much better from a linux admin perspective ;) 
                </p>

                <p>
                    Also place a tomcat installation in the [user-home]/tomcat dir and create a symlink to it called 'latest'. This is for easy 
                    tomcat upgrading later on, or maybe even have a user choose which tomcat version he wants to run. Anyway, like this
                </p>

                <pre>
drwxr-xr-x  13 martijn  admin  442 21 dec 10:05 apache-tomcat-7.0.34
lrwxr-xr-x   1 martijn  admin   20 21 dec 10:08 latest -> apache-tomcat-7.0.34
                </pre>

                <p>
                    So you would end up with [user-home]/tomcat/latest being the tomcat home.
                </p>
                <p>
                    You will also need to change the port of this tomcat installation to be different from the tomcat you are already running behind port 8080. 
                    Change this in the [tomcat-home]/conf/server.xml
                </p>

                <pre>
&lt;Server port="8005" shutdown="SHUTDOWN"&gt;

into:
                    
&lt;Server port="8105" shutdown="SHUTDOWN"&gt;

and

&lt;Connector port="8080" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" /&gt;

into:

&lt;Connector port="8180" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" /&gt;

                </pre>

                <p>
                    You can change this to any port you see fit as long as you remember what it is.
                </p>

                <p>
                    The java folder stays empty for now, i'm still working on a few issues before the private VM can be run, 
                    so all is going to run on one JVM for now.
                </p>


                <h4>The last bits</h4>

                <p>
                    Time to build and deploy the Stormcloud API war file. Run a <code>mvn clean install</code> on the api project
                    and you should end up with a stormcloud.war in the target dir. Deploy this into the Tomcat instance running behind port 8080.
                </p>

                <p>
                    Check if the deployment is without errors in the tomcat logfile ([tomcat-home/logs/catalina.out])
                </p>

                <p>
                    A few settings in the database need to be edited to resemble your setup and change the API user credentials.    
                </p>

                <p>
                    In the user table change the user_name, password into anything you want to use, this is the user against which 
                    the API calls need to be authenticated. The email address, well, it does not do anything yet so, fill in 
                    whatever you want.
                </p>
                <p>
                    The same table holds the home_folder, project_folder, m2_folder and you will have to change them to the respective 
                    filesystem paths where you placed these User Home folders.
                </p>

                <p>
                    Now... if you brought it this far you are almost set to go BUT...
                </p>

                <p>
                    We need to tie things together between Apache and Tomcat and configure some things in the gui. 
                    In your apache configuration add these proxy rules:
                </p>

                <pre>
ProxyRequests Off
ProxyPreserveHost On

&lt;Proxy *&gt;
Order allow,deny
Allow from all
&lt;/Proxy&gt;

# Stormcloud Rest API
ProxyPass /stormcloud http://localhost:8080/stormcloud
ProxyPassReverse /stormcloud http://localhost:8080/stormcloud

# Stormcloud Chat (Comet)
ProxyPass /cometd http://localhost:8080/cometd-demo-2.5.0/cometd
ProxyPassReverse /cometd http://localhost:8080/cometd-demo-2.5.0/cometd
                </pre>

                <p>
                    And now i see the second rule for cometd, yes that one needs to be deployed in tomcat as well... 
                    for now i have added the cometd-demo-2.5.0.war in api/core/src/main/cometd which you can directly deploy 
                    into tomcat. It's a demo war and basically a left over of the chat proof of concept i made so at some point there 
                    has to be an 'own' cometd implementation.
                </p>

                <p>
                    Almost there, the gui needs to know a few things, this is mainly because it's a work in progress, anyway, here goes:
                </p>

                <p>
                    In the gui/js/stormcloud/_base/context.js you will have to change the values as shown below into values that comply with 
                    how you have your setup.
                    I have added 127.0.0.1  stormcloud-ide.com in my /etc/hosts file. You can also just use localhost, whichever you prefer 
                    as long as these values are according to what you type in the browser to reach the GUI (this is a cross-domain/origin thing).
                </p>

                <p>
                    I also have added 127.0.0.1 martijn.stormcloud-ide.com to the hosts file and pointed it in the context file to my 'private' 
                    tomcat installation in the user home.
                </p>

                <pre>
host                : 'stormcloud-ide.com',
tomcatViewUrl       : 'martijn.stormcloud-ide.com:8180',
tomcatManagerUrl    : 'martijn.stormcloud-ide.com/manager/text/',
                </pre>

                <p>
                    Also change the value in the gui/js/stormcloud/_base/auth.js to read the user/pass you have in the database user table.
                    mine reads:
                </p>

                <pre>
return base64.encode('martijn:1');
                </pre>

                <p>
                    that's what i have in the database user_name : martijn, password : 1
                </p>

                <p>
                    If all is well (i'm not sure if i missed anything, but probably did) you can now start the tomcat instance with the 
                    API and cometd in it (the one behind port 8080) and when you serve the GUI now it should show the contents of your
                    User Home Tomcat installation under the services Tab.
                </p>

                <p>
                    Try to create a new project and if all is well you will be able to browse it in the projects and files pane. 
                </p>

                <p>
                    Pfew, i know it's a bit of bump but it's a one-time setup, once it works you can run and code!
                </p>

                Place any questions on the <a href="http://stormcloud-ide.44872.n6.nabble.com/">Mailing list</a> so 
                we can keep it central for anyone to read and know! 
                </p>

            </section>

            <footer>

                <p>
                    The Backbone:
                </p>

                <p>
                    <a href="https://github.com/stormcloud-ide/gui">
                        <img alt="Stormcloud IDE - Project" src="../images/gui-logo-trimmed.png">
                    </a>
                </p>

                <p>
                    <a href="https://github.com/stormcloud-ide/api">
                        <img alt="Stormcloud IDE - Project" src="../images/api-logo-trimmed.png">
                    </a>
                </p>


                <table>
                    <tr>
                        <td style="width: 30px;padding:0px;">
                            <iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FStormcloud-IDE%2F442619979140451&amp;send=false&amp;layout=standard&amp;width=50&amp;show_faces=false&amp;font=arial&amp;colorscheme=light&amp;action=like&amp;height=25"
                                    scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:25px;" allowTransparency="true"></iframe>
                        </td>
                        <td style="width: 30px; padding:0px;">
                            <a href="http://www.linkedin.com/groups/Stormcloud-IDE-4772256" 
                               style="text-decoration:none;">
                                <img src="../images/linkedin.jpg" width="30" height="30" alt="View Stormcloud IDE on LinkedIn" border="0">
                            </a>
                        </td>
                        <td style="padding-left: 1px;">
                            <a href="https://twitter.com/stormcloud_ide" class="twitter-follow-button" data-show-count="false" data-size="large" data-show-screen-name="false">Follow</a>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                        </td>

                    </tr>

                </table>


                <p>
                    This project is maintained by <a href="https://github.com/stormcloud-ide">stormcloud-ide</a>
                    <br>
                    <small>Copyright (C) 2012 - 2013 Stormcloud IDE</small>
                </p>
                <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
            </footer>
        </div>
        <script src="javascripts/scale.fix.js"></script>
        <script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-37739619-6']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();

        </script>
    </body>
</html>